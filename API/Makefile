# Makefile para Biblioteca API

.PHONY: help install dev prod test clean logs stop

# Cores para output
RED=\033[0;31m
GREEN=\033[0;32m
YELLOW=\033[1;33m
NC=\033[0m # No Color

help: ## Mostrar esta ajuda
	@echo "$(GREEN)Biblioteca API - Comandos disponÃ­veis:$(NC)"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "$(YELLOW)%-15s$(NC) %s\n", $$1, $$2}'

install: ## Instalar dependÃªncias
	@echo "$(GREEN)ğŸ“¦ Instalando dependÃªncias...$(NC)"
	pip install -r requirements.txt

dev: ## Executar em modo desenvolvimento
	@echo "$(GREEN)ğŸ› ï¸ Iniciando modo desenvolvimento...$(NC)"
	chmod +x scripts/run_development.sh
	./scripts/run_development.sh

prod: ## Executar em modo produÃ§Ã£o (Docker)
	@echo "$(GREEN)ğŸš€ Iniciando modo produÃ§Ã£o...$(NC)"
	chmod +x scripts/run_production.sh
	./scripts/run_production.sh

test: ## Executar testes
	@echo "$(GREEN)ğŸ§ª Executando testes...$(NC)"
	pytest tests/ -v --asyncio-mode=auto

test-cov: ## Executar testes com cobertura
	@echo "$(GREEN)ğŸ§ª Executando testes com cobertura...$(NC)"
	pytest tests/ -v --asyncio-mode=auto --cov=biblioteca_api --cov-report=html

lint: ## Verificar cÃ³digo com linting
	@echo "$(GREEN)ğŸ” Verificando cÃ³digo...$(NC)"
	flake8 biblioteca_api/
	pylint biblioteca_api/

format: ## Formatar cÃ³digo
	@echo "$(GREEN)âœ¨ Formatando cÃ³digo...$(NC)"
	black biblioteca_api/
	isort biblioteca_api/

logs: ## Ver logs da aplicaÃ§Ã£o
	@echo "$(GREEN)ğŸ“‹ Logs da aplicaÃ§Ã£o:$(NC)"
	docker-compose logs -f api

logs-all: ## Ver logs de todos os serviÃ§os
	@echo "$(GREEN)ğŸ“‹ Logs de todos os serviÃ§os:$(NC)"
	docker-compose logs -f

stop: ## Parar todos os serviÃ§os
	@echo "$(RED)ğŸ›‘ Parando serviÃ§os...$(NC)"
	docker-compose down

clean: ## Limpar containers e volumes
	@echo "$(RED)ğŸ§¹ Limpando containers e volumes...$(NC)"
	docker-compose down -v
	docker system prune -f

status: ## Verificar status dos serviÃ§os
	@echo "$(GREEN)ğŸ“Š Status dos serviÃ§os:$(NC)"
	docker-compose ps

build: ## Build dos containers
	@echo "$(GREEN)ğŸ”¨ Fazendo build...$(NC)"
	docker-compose build

restart: ## Reiniciar serviÃ§os
	@echo "$(YELLOW)ğŸ”„ Reiniciando serviÃ§os...$(NC)"
	docker-compose restart

shell: ## Shell no container da API
	@echo "$(GREEN)ğŸš Abrindo shell no container...$(NC)"
	docker-compose exec api /bin/bash
